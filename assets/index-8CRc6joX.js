var e=Object.defineProperty,__publicField=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&processPreload(e)})).observe(document,{childList:!0,subtree:!0})}function processPreload(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t=(e=>(e.INITIAL="initial",e.FETCHED="fetched",e.ERROR="error",e.CANCELED="canceled",e.IN_CARD_FORM="in-card-form",e.IN_PHONE_FORM="in-phone-form",e.IN_OTP_FORM="in-otp-form",e.FINAL="final",e))(t||{});class BaseComponent{constructor(e){__publicField(this,"store"),__publicField(this,"state"),__publicField(this,"templates",Object.assign({"./canceled/canceled.template.html":'<section class="container">\n  <div class="col-container">\n    <h1 class="heading" id="main-heading">{message}</h1>\n\n    <button\n      id="closeBtn"\n      class="btn btn-primary"\n      aria-label="Close the form"\n      aria-labelledby="main-heading"\n    >\n      <span>Close</span>\n    </button>\n  </div>\n</section>\n',"./card-form/card-form.template.html":'<section class="container">\n  <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">\n    <div class="mx-auto max-w-5xl">\n      <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12">\n        <form class="form bordered-form" aria-labelledby="credit-card-form">\n          <h2 id="credit-card-form" class="sr-only">Add Credit Card</h2>\n\n          <div class="mb-6 grid grid-cols-2 gap-4">\n            \x3c!-- Card Number Input --\x3e\n            <div class="ol-span-2 sm:col-span-1">\n              <label\n                for="card-number-input"\n                class="mb-2 block text-sm font-medium"\n                >Card number*</label\n              >\n              <input\n                type="text"\n                class="form-input"\n                aria-required="true"\n                inputmode="numeric"\n                id="card-number-input"\n                placeholder="xxxx-xxxx-xxxx-xxxx"\n                aria-describedby="card-number-description"\n              />\n              <span id="card-number-description" class="sr-only">\n                Enter your 16-digit card number without spaces or dashes.\n              </span>\n            </div>\n\n            \x3c!-- Zipcode Input --\x3e\n            <div class="ol-span-2 sm:col-span-1">\n              <label for="zipcode" class="mb-2 block text-sm font-medium"\n                >Zipcode*</label\n              >\n              <input\n                type="text"\n                id="zipcode"\n                maxlength="5"\n                class="form-input"\n                inputmode="numeric"\n                placeholder="12345"\n                aria-required="true"\n                aria-describedby="zipcode-description"\n              />\n              <span id="zipcode-description" class="sr-only">\n                Enter a 5-digit ZIP code.\n              </span>\n            </div>\n\n            \x3c!-- Card Expiration Input --\x3e\n            <div class="ol-span-2 sm:col-span-1">\n              <label\n                for="card-expiration-input"\n                class="mb-2 block text-sm font-medium"\n                >Card expiration*</label\n              >\n              <div class="relative">\n                <input\n                  type="text"\n                  class="form-input"\n                  placeholder="MM/YY"\n                  inputmode="numeric"\n                  aria-required="true"\n                  id="card-expiration-input"\n                  aria-describedby="card-expiration-description"\n                />\n                <span id="card-expiration-description" class="sr-only">\n                  Enter the expiration date in MM/YY format.\n                </span>\n              </div>\n            </div>\n\n            \x3c!-- CVV Input with Tooltip --\x3e\n            <div class="ol-span-2 sm:col-span-1">\n              <label for="cvv-input" class="mb-2 block text-sm font-medium">\n                CVV*\n                <button\n                  type="button"\n                  class="relative group"\n                  aria-label="CVV information"\n                >\n                  <svg\n                    aria-hidden="true"\n                    fill="currentColor"\n                    viewBox="0 0 24 24"\n                    xmlns="http://www.w3.org/2000/svg"\n                    class="h-4 w-4 text-gray-400 hover:text-navy-blue"\n                  >\n                    <path\n                      fill-rule="evenodd"\n                      clip-rule="evenodd"\n                      d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm9.408-5.5a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2h-.01ZM10 10a1 1 0 1 0 0 2h1v3h-1a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1v-4a1 1 0 0 0-1-1h-2Z"\n                    />\n                  </svg>\n                  <span\n                    role="tooltip"\n                    aria-hidden="true"\n                    class="absolute left-1/2 top-full mt-1 hidden w-max -translate-x-1/2 rounded-lg bg-navy-blue px-3 py-2 text-sm font-medium text-white shadow-md group-hover:block"\n                  >\n                    The last 3-4 digits on the back of the card\n                  </span>\n                </button>\n              </label>\n              <input\n                type="text"\n                id="cvv-input"\n                maxlength="4"\n                placeholder="•••"\n                class="form-input"\n                inputmode="numeric"\n                aria-required="true"\n                aria-describedby="cvv-description"\n              />\n              <span id="cvv-description" class="sr-only">\n                Enter the 3-digit security code found on the back of your card.\n              </span>\n            </div>\n          </div>\n\n          \x3c!-- Submit Button --\x3e\n          <button\n            type="submit"\n            aria-label="Pay now"\n            class="btn btn-primary w-full"\n          >\n            Pay now\n          </button>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <span id="error" class="error" role="alert"></span>\n</section>\n',"./confirmation/confirmation.template.html":'<div class="container">\n  <h1 class="heading" id="verification-heading">\n    You are at\n    <span class="highlighted-span" id="merchant-name">{merchantName}</span> Pump\n    <span class="highlighted-span" id="pump-number">{pumpNumber}</span> <br />\n    and your car plate number is\n    <span class="highlighted-span" id="plate-number">{plateNumber}</span>\n  </h1>\n\n  <meta\n    name="description"\n    content="Verify your car details at {merchantName} gas station pump {pumpNumber}"\n  />\n\n  <div class="col-container w-full max-w-lg px-4">\n    <img\n      src="{imageUrl}"\n      class="image shadow-lg"\n      alt="Your car at pump {pumpNumber}"\n      aria-describedby="verification-heading"\n    />\n\n    <div class="mt-6 flex w-full justify-between gap-4">\n      <button\n        id="cancelBtn"\n        class="btn btn-secondary"\n        aria-label="Cancel verification"\n        aria-describedby="verification-heading"\n      >\n        <svg\n          viewBox="0 0 24 24"\n          focusable="false"\n          aria-hidden="true"\n          fill="currentColor"\n          xmlns="http://www.w3.org/2000/svg"\n          class="w-5 h-5 sm:w-6 sm:h-6 text-white"\n        >\n          <path\n            fill-rule="evenodd"\n            clip-rule="evenodd"\n            d="M6.225 4.811a1 1 0 011.414 0L12 9.172l4.361-4.361a1 1 0 011.414 1.414L13.414 10.586l4.361 4.361a1 1 0 01-1.414 1.414L12 12l-4.361 4.361a1 1 0 01-1.414-1.414l4.361-4.361L6.225 6.225a1 1 0 010-1.414z"\n          />\n        </svg>\n\n        <span class="sr-only">Cancel verification</span>\n      </button>\n\n      <button\n        id="verifyBtn"\n        class="btn btn-primary"\n        aria-label="Verify car details"\n        aria-describedby="verification-heading"\n      >\n        <svg\n          focusable="false"\n          aria-hidden="true"\n          fill="currentColor"\n          viewBox="0 0 24 24"\n          xmlns="http://www.w3.org/2000/svg"\n          class="w-5 h-5 sm:w-6 sm:h-6 text-navy-blue"\n        >\n          <path\n            fill-rule="evenodd"\n            clip-rule="evenodd"\n            d="M9 16.172l9.192-9.192a1 1 0 111.414 1.414L9 19 4.394 14.394a1 1 0 111.414-1.414L9 16.172z"\n          />\n        </svg>\n\n        <span class="sr-only">Confirm verification</span>\n      </button>\n    </div>\n  </div>\n\n  <button\n    id="tosBtn"\n    class="linkLikeButton mt-6"\n    aria-controls="tosPpModalContainer"\n    aria-label="Open Terms Of Service And Privacy Policy modal"\n  >\n    Terms of Service & Privacy Policy\n  </button>\n\n  <div\n    role="dialog"\n    aria-modal="true"\n    aria-labelledby="tosBtn"\n    id="tosPpModalContainer"\n  ></div>\n</div>\n',"./final/final.template.html":'<div class="container">\n  <div class="col-container">\n    <img\n      role="img"\n      class="w-full h-64 md:h-80 object-cover rounded-lg"\n      src="pump.svg"\n      alt="Illustration of a gas pump"\n      aria-describedby="pump-instructions"\n    />\n\n    <h1 id="pump-instructions" class="heading">\n      Please lift fuel nozzle and select grade\n    </h1>\n  </div>\n</div>\n',"./initial/initial.template.html":'<div class="container">\n  <div class="relative w-12 h-12">\n    <div\n      class="absolute w-full h-full border-4 rounded-full border-transparent border-t-sunflower-yellow animate-spin"\n    ></div>\n    <div\n      class="absolute w-full h-full border-4 rounded-full border-transparent border-b-navy-blue animate-[spin_1.5s_linear_reverse_infinite]"\n    ></div>\n  </div>\n</div>\n',"./otp-form/otp-form.template.html":'<div class="container">\n  <div\n    class="form col-container border border-gray-200 shadow-sm justify-between"\n  >\n    <div class="col-container">\n      <div class="font-semibold text-3xl">\n        <p>Phone Verification</p>\n      </div>\n      <div class="flex flex-row text-sm font-medium text-gray-400">\n        <p>We have sent a code to your phone number</p>\n      </div>\n    </div>\n\n    <form class="form">\n      <div\n        class="flex flex-row items-center justify-between mx-auto w-full gap-1 my-5"\n      >\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n        <div class="w-16 h-16">\n          <input\n            name="otp"\n            class="input-no-spinner w-full h-full flex flex-col items-center justify-center text-center md:px-5 outline-none rounded-xl border border-sunflower-yellow text-lg bg-white focus:bg-gray-50 focus:ring-1 focus:border-navy-blue ring-navy-blue"\n            type="number"\n            min="0"\n            max="9"\n          />\n        </div>\n      </div>\n\n      <button class="btn btn-primary w-full">Verify</button>\n    </form>\n    <span id="error" class="error mx-auto" role="alert"></span>\n  </div>\n</div>\n',"./phone-form/phone-form.template.html":'<section class="container">\n  <div class="col-container">\n    <h1 class="heading">\n      Save your car plate with your payment card and get\n      <span id="initial_discount" class="highlighted-span">$5</span> off today\n      and\n      <span id="discount" class="highlighted-span">3c/gal</span>\n      going forward\n    </h1>\n    <form class="col-container max-w-sm mx-auto gap-5">\n      <label for="phone-input" class="sr-only">Phone Number</label>\n      <input\n        type="tel"\n        id="phone-input"\n        maxlength="10"\n        inputmode="numeric"\n        aria-required="true"\n        placeholder="1234567890"\n        class="form-input min-w-72"\n      />\n      <button type="submit" class="btn btn-primary" aria-label="Register">\n        Register\n      </button>\n    </form>\n    <span id="error" class="error" role="alert"></span>\n\n    <button\n      id="skip"\n      class="linkLikeButton"\n      aria-label="Skip registration and proceed without linking a payment method"\n    >\n      Skip\n    </button>\n\n    <div class="mt-6">\n      By providing your phone number you agree to our\n      <button\n        id="ppBtn"\n        class="linkLikeButton"\n        aria-controls="ppModalContainer"\n        aria-label="Open Privacy Policy modal"\n      >\n        Privacy Policy\n      </button>\n      And\n      <button\n        id="tosBtn"\n        class="linkLikeButton"\n        aria-controls="tosModalContainer"\n        aria-label="Open Terms of Service modal"\n      >\n        Terms Of Service\n      </button>\n    </div>\n\n    <div\n      id="tosModalContainer"\n      role="dialog"\n      aria-modal="true"\n      aria-label="TOS Modal"\n    ></div>\n    <div\n      id="ppModalContainer"\n      role="dialog"\n      aria-modal="true"\n      aria-label="PP Modal"\n    ></div>\n  </div>\n</section>\n'})),this.store=e,this.state=e.getState()}handleDomAccessError(e){this.store.transitionTo(t.ERROR)}$(e){const t=document.querySelector(e);return t||this.handleDomAccessError(e),t}$_all(e){const t=document.querySelectorAll(e);return 0===t.length&&this.handleDomAccessError(e),t}buildTemplatePath(){const e=this.constructor.name.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().replace("-component","");return`./${e}/${e}.template.html`}processTemplate(e,t){return e.replace(/\{([^{}]+)\}/g,((e,n)=>n.trim()in t?t[n.trim()]:""))}templateData(){return{}}render(){const e=this.buildTemplatePath();if(e in this.templates)try{const t=this.templates[e];return this.processTemplate(t,this.templateData())}catch(n){this.store.transitionTo(t.ERROR)}return""}preventNonNumericValues(e,t){t.forEach((t=>{const n=e.querySelector(t);n.addEventListener("input",(()=>{n.value=n.value.replace(/\D/g,"")}))}))}attachEvents(){}}class InitialComponent extends BaseComponent{}class ModalService{constructor(e){__publicField(this,"modalsState",{}),this.getModalTemplate=e}toggleModal(e){e in this.modalsState||(this.modalsState[e]=!1),this.modalsState[e]=!this.modalsState[e],this.updateModalUI(e)}updateModalUI(e){const t=document.getElementById(`${e}Container`);t&&(t.innerHTML="",t.innerHTML=this.modalsState[e]?this.getModalTemplate(e):"",this.attachModalEvent(e))}attachModalEvent(e){var t;null==(t=document.getElementById(`${e}Close`))||t.addEventListener("click",(()=>{this.modalsState[e]=!1,this.updateModalUI(e)}))}}class ConfirmationComponent extends BaseComponent{constructor(e){super(e),__publicField(this,"modalService"),__publicField(this,"cancelButton"),__publicField(this,"verifyButton"),__publicField(this,"tosButton"),this.modalService=new ModalService(this.getModalTemplate)}attachEvents(){this.cancelButton=this.$("#cancelBtn"),this.verifyButton=this.$("#verifyBtn"),this.tosButton=this.$("#tosBtn"),this.cancelButton.addEventListener("click",(()=>this.handleCancelClick())),this.verifyButton.addEventListener("click",(()=>this.handleVerifyClick())),this.tosButton.addEventListener("click",(()=>this.handleTosClick()))}handleCancelClick(){this.store.transitionTo(t.CANCELED)}handleVerifyClick(){this.store.transitionTo(t.IN_CARD_FORM)}handleTosClick(){this.modalService.toggleModal("tosPpModal")}getModalTemplate(e){return"tosPpModal"===e?'<div\n  class="modal"\n  role="dialog"\n  aria-modal="true"\n  aria-labelledby="modal-heading"\n>\n  <div class="modal-card">\n    <h2 id="modal-heading" class="modal-heading">\n      Terms of Service & Privacy Policy\n    </h2>\n    <p id="modal-description" class="modal-content">\n      By using this service, you agree to our terms and conditions...\n    </p>\n    <button\n      id="tosPpModalClose"\n      class="btn btn-close"\n      aria-label="Close Terms of Service and Privacy Policy"\n    >\n      Close\n    </button>\n  </div>\n</div>\n':""}templateData(){return{merchantName:this.state.merchantName,pumpNumber:this.state.pumpNumber,plateNumber:this.state.plateNumber,imageUrl:this.state.imageUrl}}}class CanceledComponent extends BaseComponent{constructor(e,t){super(e),__publicField(this,"message"),this.message=t}templateData(){return{message:this.message}}}class ErrorComponent extends CanceledComponent{buildTemplatePath(){return"./canceled/canceled.template.html"}}class FinalComponent extends BaseComponent{}var n,r={exports:{}};var i=(n||(n=1,function(e,t,n){var validate2=function(e,t,n){n=r.extend({},r.options,n);var i=r.runValidations(e,t,n);if(i.some((function(e){return r.isPromise(e.error)})))throw new Error("Use validate.async if you want support for promises");return validate2.processValidationResults(i,n)},r=validate2;r.extend=function(e){return[].slice.call(arguments,1).forEach((function(t){for(var n in t)e[n]=t[n]})),e},r.extend(validate2,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var e=r.format("%{major}.%{minor}.%{patch}",r.version);return r.isEmpty(r.version.metadata)||(e+="+"+r.version.metadata),e}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(e,t,n){var i,a,s,o,l,u,c,d=[];for(i in(r.isDomElement(e)||r.isJqueryElement(e))&&(e=r.collectFormValues(e)),t)for(a in s=r.getDeepObjectValue(e,i),o=r.result(t[i],s,e,i,n,t)){if(!(l=r.validators[a]))throw c=r.format("Unknown validator %{name}",{name:a}),new Error(c);u=o[a],(u=r.result(u,s,e,i,n,t))&&d.push({attribute:i,value:s,validator:a,globalOptions:n,attributes:e,options:u,error:l.call(l,s,u,i,e,n)})}return d},processValidationResults:function(e,t){e=r.pruneEmptyErrors(e,t),e=r.expandMultipleErrors(e,t),e=r.convertErrorMessages(e,t);var n=t.format||"grouped";if("function"!=typeof r.formatters[n])throw new Error(r.format("Unknown format %{format}",t));return e=r.formatters[n](e),r.isEmpty(e)?void 0:e},async:function(e,t,n){var i=(n=r.extend({},r.async.options,n)).wrapErrors||function(e){return e};!1!==n.cleanAttributes&&(e=r.cleanAttributes(e,t));var a=r.runValidations(e,t,n);return new r.Promise((function(s,o){r.waitForResults(a).then((function(){var l=r.processValidationResults(a,n);l?o(new i(l,n,e,t)):s(e)}),(function(e){o(e)}))}))},single:function(e,t,n){return n=r.extend({},r.single.options,n,{format:"flat",fullMessages:!1}),r({single:e},{single:t},n)},waitForResults:function(e){return e.reduce((function(e,t){return r.isPromise(t.error)?e.then((function(){return t.error.then((function(e){t.error=e||null}))})):e}),new r.Promise((function(e){e()})))},result:function(e){var t=[].slice.call(arguments,1);return"function"==typeof e&&(e=e.apply(null,t)),e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isFunction:function(e){return"function"==typeof e},isInteger:function(e){return r.isNumber(e)&&e%1==0},isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e===Object(e)},isDate:function(e){return e instanceof Date},isDefined:function(e){return null!=e},isPromise:function(e){return!!e&&r.isFunction(e.then)},isJqueryElement:function(e){return e&&r.isString(e.jquery)},isDomElement:function(e){return!!e&&!(!e.querySelectorAll||!e.querySelector)&&(!(!r.isObject(document)||e!==document)||("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName))},isEmpty:function(e){var t;if(!r.isDefined(e))return!0;if(r.isFunction(e))return!1;if(r.isString(e))return r.EMPTY_STRING_REGEXP.test(e);if(r.isArray(e))return 0===e.length;if(r.isDate(e))return!1;if(r.isObject(e)){for(t in e)return!1;return!0}return!1},format:r.extend((function(e,t){return r.isString(e)?e.replace(r.format.FORMAT_REGEXP,(function(e,n,r){return"%"===n?"%{"+r+"}":String(t[r])})):e}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(e){return r.isNumber(e)?100*e%1==0?""+e:parseFloat(Math.round(100*e)/100).toFixed(2):r.isArray(e)?e.map((function(e){return r.prettify(e)})).join(", "):r.isObject(e)?r.isDefined(e.toString)?e.toString():JSON.stringify(e):(e=""+e).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(e,t,n){return t+" "+n.toLowerCase()})).toLowerCase()},stringifyValue:function(e,t){return(t&&t.prettify||r.prettify)(e)},isString:function(e){return"string"==typeof e},isArray:function(e){return"[object Array]"==={}.toString.call(e)},isHash:function(e){return r.isObject(e)&&!r.isArray(e)&&!r.isFunction(e)},contains:function(e,t){return!!r.isDefined(e)&&(r.isArray(e)?-1!==e.indexOf(t):t in e)},unique:function(e){return r.isArray(e)?e.filter((function(e,t,n){return n.indexOf(e)==t})):e},forEachKeyInKeypath:function(e,t,n){if(r.isString(t)){var i,a="",s=!1;for(i=0;i<t.length;++i)switch(t[i]){case".":s?(s=!1,a+="."):(e=n(e,a,!1),a="");break;case"\\":s?(s=!1,a+="\\"):s=!0;break;default:s=!1,a+=t[i]}return n(e,a,!0)}},getDeepObjectValue:function(e,t){if(r.isObject(e))return r.forEachKeyInKeypath(e,t,(function(e,t){if(r.isObject(e))return e[t]}))},collectFormValues:function(e,t){var n,i,a,s,o,l,u={};if(r.isJqueryElement(e)&&(e=e[0]),!e)return u;for(t=t||{},s=e.querySelectorAll("input[name], textarea[name]"),n=0;n<s.length;++n)if(a=s.item(n),!r.isDefined(a.getAttribute("data-ignored"))){var c=a.name.replace(/\./g,"\\\\.");l=r.sanitizeFormValue(a.value,t),"number"===a.type?l=l?+l:null:"checkbox"===a.type?a.attributes.value?a.checked||(l=u[c]||null):l=a.checked:"radio"===a.type&&(a.checked||(l=u[c]||null)),u[c]=l}for(s=e.querySelectorAll("select[name]"),n=0;n<s.length;++n)if(a=s.item(n),!r.isDefined(a.getAttribute("data-ignored"))){if(a.multiple)for(i in l=[],a.options)(o=a.options[i])&&o.selected&&l.push(r.sanitizeFormValue(o.value,t));else{var d=void 0!==a.options[a.selectedIndex]?a.options[a.selectedIndex].value:"";l=r.sanitizeFormValue(d,t)}u[a.name]=l}return u},sanitizeFormValue:function(e,t){return t.trim&&r.isString(e)&&(e=e.trim()),!1!==t.nullify&&""===e?null:e},capitalize:function(e){return r.isString(e)?e[0].toUpperCase()+e.slice(1):e},pruneEmptyErrors:function(e){return e.filter((function(e){return!r.isEmpty(e.error)}))},expandMultipleErrors:function(e){var t=[];return e.forEach((function(e){r.isArray(e.error)?e.error.forEach((function(n){t.push(r.extend({},e,{error:n}))})):t.push(e)})),t},convertErrorMessages:function(e,t){var n=[],i=(t=t||{}).prettify||r.prettify;return e.forEach((function(e){var a=r.result(e.error,e.value,e.attribute,e.options,e.attributes,e.globalOptions);r.isString(a)?("^"===a[0]?a=a.slice(1):!1!==t.fullMessages&&(a=r.capitalize(i(e.attribute))+" "+a),a=a.replace(/\\\^/g,"^"),a=r.format(a,{value:r.stringifyValue(e.value,t)}),n.push(r.extend({},e,{error:a}))):n.push(e)})),n},groupErrorsByAttribute:function(e){var t={};return e.forEach((function(e){var n=t[e.attribute];n?n.push(e):t[e.attribute]=[e]})),t},flattenErrorsToArray:function(e){return e.map((function(e){return e.error})).filter((function(e,t,n){return n.indexOf(e)===t}))},cleanAttributes:function(e,t){function whitelistCreator(e,t,n){return r.isObject(e[t])?e[t]:e[t]=!!n||{}}return r.isObject(t)&&r.isObject(e)?function cleanRecursive(e,t){if(!r.isObject(e))return e;var n,i,a=r.extend({},e);for(i in e)n=t[i],r.isObject(n)?a[i]=cleanRecursive(a[i],n):n||delete a[i];return a}(e,t=function(e){var t,n={};for(t in e)e[t]&&r.forEachKeyInKeypath(n,t,whitelistCreator);return n}(t)):{}},exposeModule:function(e,t,n,r,i){n?(r&&r.exports&&(n=r.exports=e),n.validate=e):(t.validate=e,e.isFunction(i)&&i.amd&&i([],(function(){return e})))},warn:function(e){"undefined"!=typeof console&&console.warn},error:function(e){"undefined"!=typeof console&&console.error}}),validate2.validators={presence:function(e,t){if(!1!==(t=r.extend({},this.options,t)).allowEmpty?!r.isDefined(e):r.isEmpty(e))return t.message||this.message||"can't be blank"},length:function(e,t,n){if(r.isDefined(e)){var i,a=(t=r.extend({},this.options,t)).is,s=t.maximum,o=t.minimum,l=[],u=(e=(t.tokenizer||function(e){return e})(e)).length;return r.isNumber(u)?(r.isNumber(a)&&u!==a&&(i=t.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",l.push(r.format(i,{count:a}))),r.isNumber(o)&&u<o&&(i=t.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",l.push(r.format(i,{count:o}))),r.isNumber(s)&&u>s&&(i=t.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",l.push(r.format(i,{count:s}))),l.length>0?t.message||l:void 0):t.message||this.notValid||"has an incorrect length"}},numericality:function(e,t,n,i,a){if(r.isDefined(e)){var s,o,l=[],u={greaterThan:function(e,t){return e>t},greaterThanOrEqualTo:function(e,t){return e>=t},equalTo:function(e,t){return e===t},lessThan:function(e,t){return e<t},lessThanOrEqualTo:function(e,t){return e<=t},divisibleBy:function(e,t){return e%t==0}},c=(t=r.extend({},this.options,t)).prettify||a&&a.prettify||r.prettify;if(r.isString(e)&&t.strict){var d="^-?(0|[1-9]\\d*)";if(t.onlyInteger||(d+="(\\.\\d+)?"),d+="$",!new RegExp(d).test(e))return t.message||t.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==t.noStrings&&r.isString(e)&&!r.isEmpty(e)&&(e=+e),!r.isNumber(e))return t.message||t.notValid||this.notValid||this.message||"is not a number";if(t.onlyInteger&&!r.isInteger(e))return t.message||t.notInteger||this.notInteger||this.message||"must be an integer";for(s in u)if(o=t[s],r.isNumber(o)&&!u[s](e,o)){var p="not"+r.capitalize(s),m=t[p]||this[p]||this.message||"must be %{type} %{count}";l.push(r.format(m,{count:o,type:c(s)}))}return t.odd&&e%2!=1&&l.push(t.notOdd||this.notOdd||this.message||"must be odd"),t.even&&e%2!=0&&l.push(t.notEven||this.notEven||this.message||"must be even"),l.length?t.message||l:void 0}},datetime:r.extend((function(e,t){if(!r.isFunction(this.parse)||!r.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(r.isDefined(e)){var n,i=[],a=(t=r.extend({},this.options,t)).earliest?this.parse(t.earliest,t):NaN,s=t.latest?this.parse(t.latest,t):NaN;return e=this.parse(e,t),isNaN(e)||t.dateOnly&&e%864e5!=0?(n=t.notValid||t.message||this.notValid||"must be a valid date",r.format(n,{value:arguments[0]})):(!isNaN(a)&&e<a&&(n=t.tooEarly||t.message||this.tooEarly||"must be no earlier than %{date}",n=r.format(n,{value:this.format(e,t),date:this.format(a,t)}),i.push(n)),!isNaN(s)&&e>s&&(n=t.tooLate||t.message||this.tooLate||"must be no later than %{date}",n=r.format(n,{date:this.format(s,t),value:this.format(e,t)}),i.push(n)),i.length?r.unique(i):void 0)}}),{parse:null,format:null}),date:function(e,t){return t=r.extend({},t,{dateOnly:!0}),r.validators.datetime.call(r.validators.datetime,e,t)},format:function(e,t){(r.isString(t)||t instanceof RegExp)&&(t={pattern:t});var n,i=(t=r.extend({},this.options,t)).message||this.message||"is invalid",a=t.pattern;if(r.isDefined(e))return r.isString(e)?(r.isString(a)&&(a=new RegExp(t.pattern,t.flags)),(n=a.exec(e))&&n[0].length==e.length?void 0:i):i},inclusion:function(e,t){if(r.isDefined(e)&&(r.isArray(t)&&(t={within:t}),t=r.extend({},this.options,t),!r.contains(t.within,e))){var n=t.message||this.message||"^%{value} is not included in the list";return r.format(n,{value:e})}},exclusion:function(e,t){if(r.isDefined(e)&&(r.isArray(t)&&(t={within:t}),t=r.extend({},this.options,t),r.contains(t.within,e))){var n=t.message||this.message||"^%{value} is restricted";return r.isString(t.within[e])&&(e=t.within[e]),r.format(n,{value:e})}},email:r.extend((function(e,t){var n=(t=r.extend({},this.options,t)).message||this.message||"is not a valid email";if(r.isDefined(e))return r.isString(e)&&this.PATTERN.exec(e)?void 0:n}),{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(e,t,n,i,a){if(r.isDefined(e)){r.isString(t)&&(t={attribute:t});var s=(t=r.extend({},this.options,t)).message||this.message||"is not equal to %{attribute}";if(r.isEmpty(t.attribute)||!r.isString(t.attribute))throw new Error("The attribute must be a non empty string");var o=r.getDeepObjectValue(i,t.attribute),l=t.comparator||function(e,t){return e===t},u=t.prettify||a&&a.prettify||r.prettify;return l(e,o,t,n,i)?void 0:r.format(s,{attribute:u(t.attribute)})}},url:function(e,t){if(r.isDefined(e)){var n=(t=r.extend({},this.options,t)).message||this.message||"is not a valid url",i=t.schemes||this.schemes||["http","https"],a=t.allowLocal||this.allowLocal||!1,s=t.allowDataUrl||this.allowDataUrl||!1;if(!r.isString(e))return n;var o="^(?:(?:"+i.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",l="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";return a?l+="?":o+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",o+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+l+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",s&&(o="(?:"+o+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"),new RegExp(o,"i").exec(e)?void 0:n}},type:r.extend((function(e,t,n,i,a){if(r.isString(t)&&(t={type:t}),r.isDefined(e)){var s,o=r.extend({},this.options,t),l=o.type;if(!r.isDefined(l))throw new Error("No type was specified");if(s=r.isFunction(l)?l:this.types[l],!r.isFunction(s))throw new Error("validate.validators.type.types."+l+" must be a function.");if(!s(e,o,n,i,a)){var u=t.message||this.messages[l]||this.message||o.message||(r.isFunction(l)?"must be of the correct type":"must be of type %{type}");return r.isFunction(u)&&(u=u(e,t,n,i,a)),r.format(u,{attribute:r.prettify(n),type:l})}}}),{types:{object:function(e){return r.isObject(e)&&!r.isArray(e)},array:r.isArray,integer:r.isInteger,number:r.isNumber,string:r.isString,date:r.isDate,boolean:r.isBoolean},messages:{}})},validate2.formatters={detailed:function(e){return e},flat:r.flattenErrorsToArray,grouped:function(e){var t;for(t in e=r.groupErrorsByAttribute(e))e[t]=r.flattenErrorsToArray(e[t]);return e},constraint:function(e){var t;for(t in e=r.groupErrorsByAttribute(e))e[t]=e[t].map((function(e){return e.validator})).sort();return e}},validate2.exposeModule(validate2,this,e,t,n)}.call(r.exports,r.exports,r,null)),r.exports);const a={cardNumber:{presence:{allowEmpty:!1},format:{pattern:/^\d{13,16}$/,message:"must be a numeric value with 13 to 16 digits"}},exp:{presence:{allowEmpty:!1},format:{pattern:/^(0[1-9]|1[0-2])\/([0-9]{2})$/,message:"must be in the format MM/YY (e.g., 12/23)"}},zipCode:{presence:{allowEmpty:!1},format:{pattern:/^\d{5}$/,message:"must be a 5-digit number"}},cvv:{presence:{allowEmpty:!1},format:{pattern:/^\d{3,4}$/,message:"must be a 3 or 4 digit number"}}};class CardFormComponent extends BaseComponent{constructor(e){super(e),__publicField(this,"form"),__publicField(this,"errorSpan"),__publicField(this,"cardNumberInput"),__publicField(this,"expInput")}attachEvents(){this.form=this.$("form"),this.errorSpan=this.$("#error"),this.cardNumberInput=this.$("#card-number-input"),this.expInput=this.$("#card-expiration-input"),this.preventNonNumericValues(this.form,["#card-number-input","#zipcode","#cvv-input"]),this.setupInputFormatting(),this.form.addEventListener("submit",(e=>this.handleSubmit(e)))}handleSubmit(e){e.preventDefault(),e.stopPropagation(),this.errorSpan.textContent="";const n=this.getFormData(),r=i.validate(n,a);r?this.errorSpan.textContent=Object.values(r)[0][0]:(this.store.setState({...this.state,cardData:n}),this.store.transitionTo(t.IN_PHONE_FORM))}getFormData(){return{cardNumber:this.cardNumberInput.value.replace(/\s/g,""),exp:this.expInput.value,zipCode:this.$("#zipcode").value,cvv:this.$("#cvv-input").value}}setupInputFormatting(){this.cardNumberInput.addEventListener("input",(()=>this.handleCardNumberInput())),this.expInput.addEventListener("input",(()=>this.handleExpInput()))}handleCardNumberInput(){const e=this.cardNumberInput.value.replace(/\D/g,"").slice(0,16);this.cardNumberInput.value=e.replace(/(\d{4})(?=\d)/g,"$1 ").trim()}handleExpInput(){const e=this.expInput.value.replace(/\D/g,"").slice(0,4);this.expInput.value=e.length>=3?`${e.slice(0,2)}/${e.slice(2)}`:e}}const s={phone:{presence:{allowEmpty:!1},format:{pattern:/^\d{10}$/,message:"must be a numeric value with 10 digits"}}};class PhoneFormComponent extends BaseComponent{constructor(e){super(e),__publicField(this,"modalService"),__publicField(this,"form"),__publicField(this,"errorSpan"),__publicField(this,"phoneInput"),__publicField(this,"skipButton"),__publicField(this,"tosButton"),__publicField(this,"ppButton"),this.modalService=new ModalService(this.getModalTemplate)}getModalTemplate(e){switch(e){case"tosModal":return'<div\n  class="modal"\n  role="dialog"\n  aria-modal="true"\n  aria-labelledby="modal-heading"\n>\n  <div class="modal-card">\n    <h2 id="modal-heading" class="modal-heading">Terms of Service</h2>\n    <p id="modal-description" class="modal-content">\n      By using this service, you agree to our terms and conditions...\n    </p>\n    <button\n      id="tosModalClose"\n      class="btn btn-close"\n      aria-label="Close Terms of Service"\n    >\n      Close\n    </button>\n  </div>\n</div>\n';case"ppModal":return'<div\n  class="modal"\n  role="dialog"\n  aria-modal="true"\n  aria-labelledby="modal-heading"\n>\n  <div class="modal-card">\n    <h2 id="modal-heading" class="modal-heading">Privacy Policy</h2>\n    <p id="modal-description" class="modal-content">\n      By using this service, you agree to our terms and conditions...\n    </p>\n    <button\n      id="ppModalClose"\n      class="btn btn-close"\n      aria-label="Close Privacy Policy"\n    >\n      Close\n    </button>\n  </div>\n</div>\n';default:return""}}attachEvents(){var e,t,n;this.form=this.$("form"),this.errorSpan=this.$("#error"),this.phoneInput=this.$("#phone-input"),this.skipButton=this.$("#skip"),this.tosButton=this.$("#tosBtn"),this.ppButton=this.$("#ppBtn"),this.preventNonNumericValues(this.form,["#phone-input"]),this.form.addEventListener("submit",(e=>this.handleSubmit(e))),null==(e=this.skipButton)||e.addEventListener("click",(()=>this.handleSkipClick())),null==(t=this.tosButton)||t.addEventListener("click",(()=>this.handleTosClick())),null==(n=this.ppButton)||n.addEventListener("click",(()=>this.handlePpClick()))}handleSubmit(e){e.preventDefault(),e.stopPropagation(),this.errorSpan.textContent="";const n=this.getFormData(),r=i.validate(n,s);r?this.errorSpan.textContent=Object.values(r)[0][0]:(this.store.setState({...this.state,phone:n.phone}),this.store.transitionTo(t.IN_OTP_FORM))}getFormData(){return{phone:this.phoneInput.value}}handleSkipClick(){this.store.transitionTo(t.FINAL)}handleTosClick(){this.modalService.toggleModal("tosModal")}handlePpClick(){this.modalService.toggleModal("ppModal")}}class OtpFormComponent extends BaseComponent{constructor(){super(...arguments),__publicField(this,"inputs"),__publicField(this,"errorSpan"),__publicField(this,"form")}attachEvents(){this.inputs=this.$_all('input[name^="otp"]'),this.errorSpan=this.$("#error"),this.form=this.$("form"),this.inputs.forEach(((e,t)=>{e.addEventListener("input",(()=>this.handleInput(e,t))),e.addEventListener("keydown",(e=>this.handleBackspace(e,t))),e.addEventListener("paste",(e=>this.handlePaste(e)))})),this.form.addEventListener("submit",(e=>this.handleSubmit(e)))}handleInput(e,t){e.value=e.value.slice(0,1);const n=this.inputs[t+1];e.value&&n&&n.focus()}handleBackspace(e,t){const n=e.target;if("Backspace"===e.key){if(""===n.value){const e=this.inputs[t-1];e&&e.focus()}else n.value="";e.preventDefault()}}handlePaste(e){var t;e.preventDefault();const n=((null==(t=e.clipboardData)?void 0:t.getData("text"))||"").replace(/\D/g,"").split("");n.length===this.inputs.length&&this.inputs.forEach(((e,t)=>e.value=n[t]||""))}handleSubmit(e){e.preventDefault(),this.errorSpan.innerHTML="";this.getFormData().length===this.inputs.length?this.store.transitionTo(t.FINAL):this.errorSpan.innerHTML="OTP must be 6 digits"}getFormData(){return Array.from(this.inputs).map((e=>e.value)).join("")}}class Renderer{constructor(){__publicField(this,"appElement"),__publicField(this,"currentComponent",null),__publicField(this,"messages",{cancel:"Please see an attendant inside to pay for fuel",error:"Something went wrong, please see an attendant inside to pay for fuel"}),this.appElement=document.getElementById("app")}createComponent(e,n){const r={[t.INITIAL]:()=>new InitialComponent(n),[t.FETCHED]:()=>new ConfirmationComponent(n),[t.FINAL]:()=>new FinalComponent(n),[t.IN_CARD_FORM]:()=>new CardFormComponent(n),[t.IN_PHONE_FORM]:()=>new PhoneFormComponent(n),[t.IN_OTP_FORM]:()=>new OtpFormComponent(n),[t.CANCELED]:()=>new CanceledComponent(n,this.messages.cancel),[t.ERROR]:()=>new ErrorComponent(n,this.messages.error)};return r[e]?r[e]():r[t.ERROR]()}update(e,t){this.appElement&&(this.currentComponent=this.createComponent(e.state,t),this.appElement.innerHTML=this.currentComponent.render(),this.currentComponent.attachEvents())}}class Store{constructor(){__publicField(this,"subscriber",null),__publicField(this,"OTP_COOKIE_KEY","otpState"),__publicField(this,"initialState",{state:t.INITIAL,merchantId:"",pumpNumber:"",plateNumber:"",merchantName:"",imageUrl:"",cardData:{cardNumber:"",exp:"",zipCode:"",cvv:""},phone:""}),__publicField(this,"state",this.initialState),this.loadStoredState()}getState(){return this.state}setState(e){this.state=e,this.notifySubscriber()}transitionTo(e){this.state.state=e,e===t.IN_OTP_FORM?this.storeOtpState():e===t.FINAL&&this.deleteStoredState(),this.notifySubscriber()}subscribe(e){this.subscriber=e}notifySubscriber(){this.subscriber&&this.subscriber.update(this.state,this)}setInitialState(){this.setState(this.initialState)}storeOtpState(){const{cardData:e,...t}=this.state,n="https:"===window.location.protocol;document.cookie=`${this.OTP_COOKIE_KEY}=${encodeURIComponent(JSON.stringify(t))};path=/;max-age=120${n?";secure":""}`}loadStoredState(){const e=this.getCookie(this.OTP_COOKIE_KEY);if(e)try{const t=JSON.parse(decodeURIComponent(e)),n=this.getQueryParams();t.merchantId!==n.merchantId||t.pumpNumber!==n.pumpNumber?this.deleteStoredState():this.state={...t,cardData:this.initialState.cardData}}catch{this.state=this.initialState}}deleteStoredState(){document.cookie=`${this.OTP_COOKIE_KEY}=;path=/;max-age=0;`}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?t[2]:null}getQueryParams(){const e=new URLSearchParams(window.location.search);return{merchantId:e.get("merchantId")||"",pumpNumber:e.get("pumpNumber")||""}}}class ApiService{constructor(){__publicField(this,"API_BASE_URL","https://stg-bmp-api.billmyplate.com")}async fetchConfirmationData(e,t){try{if(!e||!t)throw new Error("Invalid merchantId or pumpNumber");const n=await fetch(`${this.API_BASE_URL}/event/plate-detection/latest?merchantId=${e}&pumpNumber=${t}`);if(!n.ok)throw new Error(`Request failed: ${n.statusText}`);return await n.json()}catch(n){throw n}}}window.addEventListener("load",(async function(){const e=new Store,n=new Renderer;e.subscribe(n);const r=e.getState().state;if(r===t.INITIAL)try{const{merchantId:n,pumpNumber:r}=function(){const e=new URLSearchParams(window.location.search);return{merchantId:e.get("merchantId")||"",pumpNumber:e.get("pumpNumber")||""}}(),i=new ApiService;!function(e,n){e.setInitialState(),e.setState({...e.getState(),state:t.FETCHED,merchantId:n.merchantId,merchantName:n.merchantName,pumpNumber:n.pumpNumber,plateNumber:n.plate,imageUrl:n.imageUrl})}(e,await i.fetchConfirmationData(n,r))}catch{e.transitionTo(t.ERROR)}else e.transitionTo(r)}));
